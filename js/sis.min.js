var regenerate={post_types:"",thumbnails:"",list:"",cur:0,timeScript:[],dateScript:"",percent:"",getThumbnails:function(){var a=this,c=jQuery("input.thumbnails:checked");c.length!=jQuery('input.thumbnails[type="checkbox"]').length&&c.each(function(){a.thumbnails+="&thumbnails[]="+jQuery(this).val()})},getPostTypes:function(){var a=this,c=jQuery("input.post_types:checked");c.length!=jQuery('input.post_types[type="checkbox"]').length&&c.each(function(){a.post_types+="&post_types[]="+jQuery(this).val()})},
setMessage:function(a){jQuery("#regenerate_message").html("<p>"+a+"</p>").addClass("updated").addClass("fade").show();this.refreshProgressBar()},setTimeMessage:function(a){jQuery("#time p span.time_message").html(a)},refreshProgressBar:function(){jQuery(".progress").progressbar()},startRegenerating:function(){var a=this;this.dateScript=new Date;jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:"action=sis_ajax_thumbnail_rebuild&do=getlist"+a.post_types,beforeSend:function(){jQuery("#ajax_thumbnail_rebuild").attr("disabled",
!0);jQuery("#time").show();a.setMessage(sis.reading);a.getThumbnails();a.getPostTypes()},success:function(c){a.list=c;a.curr=0;jQuery(".progress").show();a.regenItem()}})},regenItem:function(){var a=this;if(!this.list)return this.reInit(),this.setMessage(sis.noMedia),!1;if(this.curr>=this.list.length){var c=new Date;this.reInit();this.setMessage(sis.done+this.curr+" "+sis.messageRegenerated+" finished at :"+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds())}else this.setMessage(sis.regenerating+
(this.curr+1)+sis.of+this.list.length+" ("+this.list[this.curr].title+")..."),jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:"action=sis_ajax_thumbnail_rebuild&do=regen&id="+this.list[this.curr].id+this.thumbnails,beforeSend:function(){a.percent=a.curr/a.list.length*100;jQuery(".progress").progressbar("value",a.percent);jQuery(".progress-percent span.text").html(Math.round(a.percent)+"%").closest(".progress-percent").animate({left:Math.round(a.percent)-2.5+"%"},500)},success:function(b){if((!b.src||
!b.time)&&b.error)jQuery("#error_messages").addClass("error message"),jQuery("#error_messages ul.messages").append("<li>"+b.error+"</li>");else{b.message&&jQuery("#time ul.messages").append("<li>"+b.message+"</li>");var c=new Date,e=new Date;jQuery("#thumb").show();jQuery("#thumb-img").attr("src",b.src);a.timeScript.push(b.time);for(var b=a.timeScript.length,d=0,f=0;f<b;f++)d+=a.timeScript[f];b=Math.round(d/b*a.list.length*1E3);c.setTime(a.dateScript.getTime()+b);e=a.s2t((c.getTime()-e.getTime())/
1E3);a.setTimeMessage(c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+sis.or+e+sis.beforeEnd)}a.curr++;a.regenItem()}})},s2t:function(a){a%=86400;var c=new Date(1970,0,1);c.setSeconds(a);var b=c.toTimeString().substr(0,8);a>86399&&(b=Math.floor((c-Date.parse("1/1/70"))/36E5)+b.substr(2));return b},reInit:function(){jQuery("#ajax_thumbnail_rebuild").removeAttr("disabled");jQuery(".progress, #thumb").hide()}},sizes={i:0,add:function(a,c){a.preventDefault();var b=jQuery("<tr />").attr("valign","top").addClass("new_size_"+
this.i);jQuery("<th />").attr("scope","row").append(jQuery("<input />").attr({type:"text",id:"new_size_"+this.i}).val("thumbnail-name")).appendTo(b);jQuery("<td />").append(jQuery("<input />").attr({type:"button",id:"validate_"+this.i}).val(sis.validate).addClass("button-secondary action add_size_name")).appendTo(b);jQuery(c).closest("tr").before(b);this.i++},register:function(a,c){a.preventDefault();var b=jQuery(c).closest("tr").children("th").find("input").val(),g=jQuery(c).closest("tr").children("th").find("input").attr("id"),
e=jQuery(c).closest("tbody").find('input[value="'+b+'"]').length;if(b=="thumbnail"||b=="medium"||b=="large")return alert(sis.notOriginal),!1;else if(e!=0)return alert(sis.alreadyPresent),!1;var e=jQuery("<th />").attr("scope","row").text(sis.size+" "+b),d=jQuery("<td />");jQuery("<input />").attr({type:"hidden",name:"image_name"}).val(b).appendTo(d);jQuery("<input />").attr({type:"hidden",name:"custom_image_sizes["+b+"][custom]"}).val("1").appendTo(d);jQuery("<label />").attr("for","custom_image_sizes["+
b+"][w]").text(sis.maximumWidth).append(jQuery("<input />").attr({type:"number",name:"custom_image_sizes["+b+"][w]",step:1,min:0,id:"custom_image_sizes["+b+"][w]"}).val("0").addClass("w")).appendTo(d);jQuery("<label />").attr("for","custom_image_sizes["+b+"][h]").text(sis.maximumHeight).append(jQuery("<input />").attr({type:"number",name:"custom_image_sizes["+b+"][h]",step:1,min:0,id:"custom_image_sizes["+b+"][h]"}).val("0").addClass("h")).appendTo(d);jQuery("<div />").addClass("crop").append(jQuery("<input />").attr({type:"checkbox",
name:"custom_image_sizes["+b+"][c]",id:"custom_image_sizes["+b+"][c]"}).val("1").addClass("c")).append(jQuery("<label />").attr({"for":"checkbox",id:"custom_image_sizes["+b+"][c]"}).text(sis.crop)).appendTo(d);jQuery("<div />").addClass("show").append(jQuery("<input />").attr({type:"checkbox",name:"custom_image_sizes["+b+"][s]",id:"custom_image_sizes["+b+"][s]"}).val("1").addClass("s")).append(jQuery("<label />").attr({"for":"checkbox",id:"custom_image_sizes["+b+"][s]"}).text(sis.show)).appendTo(d);
jQuery("<div />").text(sis.deleteImage).addClass("delete_size").appendTo(d);jQuery("<div />").text(sis.validateButton).addClass("add_size validate_size").appendTo(d);jQuery("#"+g).closest("tr").html(e.after(d));this.setButtons()},deleteSize:function(a,c){a.preventDefault();confirm(sis.confirmDelete)==!0&&(jQuery(c).closest("tr").remove(),this.ajaxUnregister(c))},getPhp:function(a,c){a.preventDefault();var b=jQuery(c).closest("tr");jQuery.ajax({url:sis.ajaxUrl,type:"POST",data:{action:"get_sizes"},
beforeSend:function(){b.removeClass("addPending");b.addClass("addPending")},success:function(a){jQuery("#get_php").nextAll("code").html("<br />"+a).show().css({display:"block"});b.removeClass("addPending")}})},ajaxRegister:function(a,c){a.preventDefault();var b=this,g=jQuery(c).closest("table"),e,d=jQuery(c).closest("tr"),f=d.find('input[name="image_name"]').val(),h=d.find("input.c").attr("checked"),i=d.find("input.s").attr("checked"),h=h==!1||h==void 0?!1:!0,i=i==!1||i==void 0?!1:!0,j=parseInt(d.find("input.w").val()),
k=parseInt(d.find("input.h").val());g.hasClass("ajaxing")||jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:{action:"add_size",width:j,height:k,crop:h,name:f,show:i},beforeSend:function(){d.removeClass("errorAdding notChangedAdding successAdding");d.addClass("addPending");g.addClass("ajaxing")},success:function(a){var c="";d.removeClass("addPending");g.removeClass("ajaxing");a==0?c="errorAdding":(c=a==2?"notChangedAdding":"successAdding",b.addToArray(f,j,k,h,c));d.addClass(c);d.find(".add_size .ui-button-text").text(sis.update);
clearTimeout(e);e=setTimeout(function(){d.removeClass("errorAdding notChangedAdding successAdding")},3E3)}})},ajaxUnregister:function(a){var c=this,b=jQuery(a).closest("tr").find('input[name="image_name"]').val();jQuery.ajax({url:sis.ajaxUrl,type:"POST",data:{action:"remove_size",name:b},success:function(){c.removeFromArray(a)}})},addToArray:function(a,c,b,g,e){var d=jQuery('#sis-regen .wrapper > table > tbody input[value="'+a+'"]'),f="",h,f=d.length!=0?d.closest("tr"):jQuery("#sis-regen .wrapper > table > tbody > tr:first").clone(),
g=g==!0?sis.tr:sis.fl;f.find("td > label").attr("for",a).end().find("input.thumbnails").val(a).attr("id",a).end().find("td:nth-child(2) > label").text(a).end().find("td:nth-child(3) > label").text(c+"px").end().find("td:nth-child(4) > label").text(b+"px").end().find("td:nth-child(5) > label").text(g);d.length==0&&f.appendTo("#sis-regen .wrapper > table > tbody");f.removeClass("errorAdding notChangedAdding successAdding").addClass(e);clearTimeout(h);h=setTimeout(function(){f.removeClass("errorAdding notChangedAdding successAdding")},
3E3)},removeFromArray:function(a){a=jQuery(a).closest("tr").find("input[name=image_name]").val();jQuery('#sis-regen .wrapper > table > tbody input[value="'+a+'"]').closest("tr").remove()},setButtons:function(){jQuery(".delete_size").button({icons:{primary:"ui-icon-circle-close"}});jQuery(".add_size").button({icons:{primary:"ui-icon-circle-check"}});jQuery(".crop,.show").button()}};
jQuery(function(){jQuery("#ajax_thumbnail_rebuild").click(function(){regenerate.startRegenerating()});jQuery("#add_size").click(function(a){sizes.add(a,this)});jQuery(".add_size_name").live("click",function(a){sizes.register(a,this)});jQuery(".delete_size").live("click",function(a){sizes.deleteSize(a,this)});jQuery(".validate_size").live("click",function(a){sizes.ajaxRegister(a,this)});jQuery("#get_php").click(function(a){sizes.getPhp(a,this)});jQuery("#get_php").nextAll("code").hide();jQuery("span.custom_size").closest("tr").children("th").css({color:"#89D76A"});
jQuery("span.theme_size").closest("tr").children("th").css({color:"#F2A13A"});sizes.setButtons();jQuery('<div class="ui-widget" id="msg"><div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><strong>Alert:</strong> <ul class="msg" ></ul></p></div></div>').prependTo("div#wpwrap").slideUp(0);jQuery("#msg").ajaxError(function(a,c,b){jQuery(this).find(".msg").append("<li>"+sis.ajaxErrorHandler+" "+b.url+
", status "+c.status+" : "+c.statusText+"</li>").end().stop(!1,!1).slideDown(200).delay(5E3).slideUp(200)})});
var regenerate={post_types:"",thumbnails:"",list:"",cur:0,timeScript:new Array,dateScript:"",percent:"",getThumbnails:function(){var a=this;var b=jQuery("input.thumbnails:checked");if(b.length!=jQuery('input.thumbnails[type="checkbox"]').length){b.each(function(b){a.thumbnails+="&thumbnails[]="+jQuery(this).val()})}},getPostTypes:function(){var a=this;var b=jQuery("input.post_types:checked");if(b.length!=jQuery('input.post_types[type="checkbox"]').length){b.each(function(){a.post_types+="&post_types[]="+jQuery(this).val()})}},setMessage:function(a){jQuery("#regenerate_message").html("<p>"+a+"</p>").addClass("updated").addClass("fade").show();this.refreshProgressBar()},setTimeMessage:function(a){jQuery("#time p span.time_message").html(a)},refreshProgressBar:function(){jQuery(".progress").progressbar()},checkStartRegenerating:function(){if(jQuery(".notSaved").size()>0){var a=confirm(sis.notSaved);if(a==true){this.startRegenerating()}else{return false}}else{this.startRegenerating()}},startRegenerating:function(){var a=this;this.dateScript=new Date;jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:"action=sis_ajax_thumbnail_rebuild&do=getlist"+a.post_types,beforeSend:function(){jQuery("#ajax_thumbnail_rebuild").attr("disabled",true);a.setMessage(sis.reading);a.getThumbnails();a.getPostTypes()},success:function(b){if(typeof b!=="object"){a.reInit();a.setMessage(sis.phpError);return false}jQuery("#time").show();a.list=b;a.curr=0;jQuery(".progress").show();a.regenItem()}})},regenItem:function(){var a=this;if(!this.list){this.reInit();this.setMessage(sis.noMedia);return false}if(this.curr>=this.list.length){var b=new Date;this.reInit();this.setMessage(sis.done+this.curr+" "+sis.messageRegenerated+sis.startedAt+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+sis.finishedAt+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds());return}this.setMessage(sis.regenerating+(this.curr+1)+sis.of+this.list.length+" ("+this.list[this.curr].title+")...");jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:"action=sis_ajax_thumbnail_rebuild&do=regen&id="+this.list[this.curr].id+this.thumbnails,beforeSend:function(){a.percent=a.curr/a.list.length*100;jQuery(".progress").progressbar("value",a.percent);jQuery(".progress-percent span.text").html(Math.round(a.percent)+"%").closest(".progress-percent").animate({left:Math.round(a.percent)-2.5+"%"},500)},success:function(b){if(!b.src||!b.time||b.error||typeof b!=="object"){var c="";if(typeof b!=="object")c=sis.phpError;else c=b.error;jQuery("#error_messages").addClass("error message");jQuery("#error_messages ul.messages").append("<li>"+c+"</li>")}else{if(b.message)jQuery("#time ul.messages").append("<li>"+b.message+"</li>");var d=new Date;var e=new Date;jQuery("#thumb").show();jQuery("#thumb-img").attr("src",b.src);a.timeScript.push(b.time);var f=a.timeScript.length;var g=0;for(var h=0;h<f;h++){g+=a.timeScript[h]}var i=g/f;var j=Math.round(i*a.list.length*1e3);d.setTime(a.dateScript.getTime()+j);var k=a.s2t((d.getTime()-e.getTime())/1e3);a.setTimeMessage(d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()+sis.or+k+sis.beforeEnd)}a.curr++;a.regenItem()}})},s2t:function(a){a=a%86400;var b=new Date(1970,0,1);b.setSeconds(a);var c=b.toTimeString().substr(0,8);if(a>86399)c=Math.floor((b-Date.parse("1/1/70"))/36e5)+c.substr(2);return c},reInit:function(){jQuery("#ajax_thumbnail_rebuild").removeAttr("disabled");jQuery(".progress, #thumb").hide()}};var sizes={i:0,add:function(a,b){a.preventDefault();var c=jQuery("<tr />").attr("valign","top").addClass("new_size_"+this.i);jQuery("<th />").attr("scope","row").append(jQuery("<input />").attr({type:"text",id:"new_size_"+this.i}).val("thumbnail-name")).appendTo(c);jQuery("<td />").append(jQuery("<input />").attr({type:"button",id:"validate_"+this.i}).val(sis.validate).addClass("button-secondary action add_size_name")).appendTo(c);jQuery(b).closest("tr").before(c);this.i++},register:function(a,b){a.preventDefault();var c=jQuery(b).closest("tr").children("th").find("input").val();var d=jQuery(b).closest("tr").children("th").find("input").attr("id");var e=jQuery(b).closest("tbody").find('input[value="'+c+'"]').length;if(c=="thumbnail"||c=="medium"||c=="large"){alert(sis.notOriginal);return false}else if(e!=0){alert(sis.alreadyPresent);return false}var f=jQuery("<th />").attr("scope","row").text(sis.size+" "+c);var g=jQuery("<td />");jQuery("<input />").attr({type:"hidden",name:"image_name"}).val(c).appendTo(g);jQuery("<input />").attr({type:"hidden",name:"custom_image_sizes["+c+"][custom]"}).val("1").appendTo(g);jQuery("<label />").attr("for","custom_image_sizes["+c+"][w]").text(sis.maximumWidth).append(jQuery("<input />").attr({type:"number",name:"custom_image_sizes["+c+"][w]",step:1,min:0,id:"custom_image_sizes["+c+"][w]",base_w:0}).val("0").addClass("w small-text")).appendTo(g);jQuery("<label />").attr("for","custom_image_sizes["+c+"][h]").text(sis.maximumHeight).append(jQuery("<input />").attr({type:"number",name:"custom_image_sizes["+c+"][h]",step:1,min:0,id:"custom_image_sizes["+c+"][h]",base_h:0}).val("0").addClass("h small-text")).appendTo(g);jQuery("<div />").addClass("crop").append(jQuery("<input />").attr({type:"checkbox",name:"custom_image_sizes["+c+"][c]",id:"custom_image_sizes["+c+"][c]",base_c:0}).val("1").addClass("c")).append(jQuery("<label />").attr({"for":"checkbox",id:"custom_image_sizes["+c+"][c]"}).text(sis.crop)).appendTo(g);jQuery("<div />").addClass("show").append(jQuery("<input />").attr({type:"checkbox",name:"custom_image_sizes["+c+"][s]",id:"custom_image_sizes["+c+"][s]",base_s:0}).val("1").addClass("s")).append(jQuery("<label />").attr({"for":"checkbox",id:"custom_image_sizes["+c+"][s]"}).text(sis.show)).appendTo(g);jQuery("<div />").text(sis.deleteImage).addClass("delete_size").appendTo(g);jQuery("<div />").text(sis.validateButton).addClass("add_size validate_size").appendTo(g);jQuery("#"+d).closest("tr").html(f.after(g));this.setButtons()},deleteSize:function(a,b){a.preventDefault();var c=confirm(sis.confirmDelete);if(c==true){jQuery(b).closest("tr").remove();this.ajaxUnregister(b)}},getPhp:function(a,b){a.preventDefault();var c=jQuery(b).closest("tr");jQuery.ajax({url:sis.ajaxUrl,type:"POST",data:{action:"get_sizes"},beforeSend:function(){c.removeClass("addPending");c.addClass("addPending")},success:function(a){jQuery("#get_php").nextAll("code").html("<br />"+a).show().css({display:"block"});c.removeClass("addPending")}})},ajaxRegister:function(a,b){a.preventDefault();var c=this;var d=jQuery(b).closest("table");var e;var f=jQuery(b).closest("tr");var g=f.find('input[name="image_name"]').val();var h=f.find("input.c").attr("checked");var i=f.find("input.s").attr("checked");if(h==false||h==undefined){h=false}else{h=true}if(i==false||i==undefined){i=false}else{i=true}var j=parseInt(f.find("input.w").val());var k=parseInt(f.find("input.h").val());if(!d.hasClass("ajaxing")){jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:{action:"add_size",width:j,height:k,crop:h,name:g,show:i},beforeSend:function(){f.removeClass("errorAdding notChangedAdding successAdding");f.addClass("addPending");d.addClass("ajaxing")},success:function(a){var b="";f.removeClass("addPending");d.removeClass("ajaxing");if(a==0){b="errorAdding"}else if(a==2){b="notChangedAdding";c.addToArray(g,j,k,h,b)}else{b="successAdding";c.addToArray(g,j,k,h,b)}f.find("input.h").attr({base_h:k});f.find("input.w").attr({base_w:j});f.find("input.c").attr({base_c:h});f.find("input.s").attr({base_s:i});f.addClass(b);f.find("td").removeClass("notSaved");f.find(".add_size").removeClass("validate_size").hide().children(".ui-button-text").text(sis.update);clearTimeout(e);e=setTimeout(function(){f.removeClass("errorAdding notChangedAdding successAdding")},3*1e3)}})}},ajaxUnregister:function(a){var b=this;var c=jQuery(a).closest("tr").find('input[name="image_name"]').val();jQuery.ajax({url:sis.ajaxUrl,type:"POST",data:{action:"remove_size",name:c},success:function(c){b.removeFromArray(a)}})},addToArray:function(a,b,c,d,e){var f=jQuery('#sis-regen .wrapper > table > tbody input[value="'+a+'"]');var g="";var h;if(f.length!=0)g=f.closest("tr");else g=jQuery("#sis-regen .wrapper > table > tbody > tr:first").clone();if(d==true)d=sis.tr;else d=sis.fl;g.find("td > label").attr("for",a).end().find("input.thumbnails").val(a).attr("id",a).end().find("td:nth-child(2) > label").text(a).end().find("td:nth-child(3) > label").text(b+"px").end().find("td:nth-child(4) > label").text(c+"px").end().find("td:nth-child(5) > label").text(d);if(f.length==0)g.appendTo("#sis-regen .wrapper > table > tbody");g.removeClass("errorAdding notChangedAdding successAdding").addClass(e);clearTimeout(h);h=setTimeout(function(){g.removeClass("errorAdding notChangedAdding successAdding")},3*1e3)},removeFromArray:function(a){var b=jQuery(a).closest("tr").find("input[name=image_name]").val();jQuery('#sis-regen .wrapper > table > tbody input[value="'+b+'"]').closest("tr").remove()},setButtons:function(){jQuery(".delete_size").button({icons:{primary:"ui-icon-circle-close"}});jQuery(".add_size").button({icons:{primary:"ui-icon-check"}});jQuery(".crop").button({icons:{primary:"ui-icon-arrow-4-diag"}});jQuery(".show").button({icons:{primary:"ui-icon-lightbulb"}})},displayChange:function(a){a=jQuery(a);var b=a.closest("tr").find("input.h");var c=a.closest("tr").find("input.w");var d=a.closest("tr").find("input.c");var e=a.closest("tr").find("input.s");var f=b.val();var g=c.val();var h=d.prop("checked");var i=e.prop("checked");var j=b.attr("base_h");var k=c.attr("base_w");var l=d.attr("base_c");var m=e.attr("base_s");if(l=="0")l=false;else l=true;if(m=="0")m=false;else m=true;if(f!=j||g!=k||h!=l||i!=m){a.closest("td").addClass("notSaved").find(".add_size").show()}else{a.closest("td").removeClass("notSaved").find(".add_size").hide()}}};jQuery(function(){jQuery("#ajax_thumbnail_rebuild").click(function(){regenerate.checkStartRegenerating()});jQuery("#add_size").click(function(a){sizes.add(a,this)});jQuery(".add_size_name").live("click",function(a){sizes.register(a,this)});jQuery(".delete_size").live("click",function(a){sizes.deleteSize(a,this)});jQuery(".add_size").live("click",function(a){sizes.ajaxRegister(a,this)});jQuery(".h,.w,.c,.s").live("click",function(a){sizes.displayChange(this)});jQuery("#get_php").click(function(a){sizes.getPhp(a,this)});jQuery("#get_php").nextAll("code").hide();jQuery("span.custom_size").closest("tr").children("th").css({color:"#89D76A"});jQuery("span.theme_size").closest("tr").children("th").css({color:"#F2A13A"});sizes.setButtons();jQuery(".add_size").hide();jQuery('<div class="ui-widget" id="msg"><div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><strong>Alert:</strong> <ul class="msg" ></ul></p></div></div>').prependTo("div#wpwrap").slideUp(0);jQuery("#msg").ajaxError(function(a,b,c){jQuery(this).find(".msg").append("<li>"+sis.ajaxErrorHandler+" "+c.url+", status "+b.status+" : "+b.statusText+"</li>").end().stop(false,false).slideDown(200).delay(5e3).slideUp(200)})})